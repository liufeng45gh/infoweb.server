<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lucifer.model">

  
  <select id="getAdminUserByAccount" resultType="com.lucifer.model.AdminUser">
  	select id,account,password,nick from admin_user where account=#{account}
  </select>
  <select id="getSimpleByTelephone" resultType="com.lucifer.model.AdminUser">
  	select id,account,password,enable,nick,type from user where telephone=#{telephone}
  </select>
  <select id="getUser" resultType="com.lucifer.model.AdminUser">
  	select * from admin_user where id=#{id}
  </select>
  
  <update id="updateUserNick">
  	update admin_user set nick=#{nick} where id=#{id};
  </update>
  <update id="updatePassowrd">
  	update admin_user set password=#{password} where id=#{id};
  </update>
  
  <select id="getUserInfoList" resultType="com.lucifer.model.User">
   select user.*,user_token.token from user left outer join user_token on user.id=user_token.user_id where 1= 1   
   <if test="account != null">
		and user.account=#{account}
   </if> 
   order by user.id desc  
   <if test="offset != null and perPageCount != null">
   		limit #{offset},#{perPageCount}
   </if>   
  </select>
  <select id="getUserInfoListCount" resultType="java.lang.Integer">
  	  select count(*) from user where 1= 1 
  	  <if test="account != null">
		and account=#{account}
   	  </if> 
  </select>
  <insert id="insertUser">
  	insert into user 
  	(id, device_id, nick)
  	values
  	(#{id}, #{device_id},  #{nick})
  </insert>
  <update id="updateUser">
  	update user set nick=#{nick}
  	where id=#{id}
  </update>
  
  <select id="findUserByToken" resultType="com.lucifer.model.AdminUser">
  	select user.* from user_token left outer join user on user_token.user_id=user.id where user_token.token=#{token}
  </select>
  
  <!-- user token -->
  <insert id="insertToken">
  	insert into user_token (token,user_id) values(#{token},#{id})
  </insert>
  <update id="updateToken">
  	update user_token set token = #{token} where user_id=#{id}
  </update>
  
	<select id="getUserByDeviceId" resultType="com.lucifer.model.User">
	select user.*  from user where user.device_id = #{device_id}
	</select>
	
	<!-- user device token -->
	<update id="updateUserDeviceToken">
	update user_device_token set device_id = #{device_id} and updated_at = now() where device_token = #{device_token}
	</update>
	<insert id="insertUserDeviceToken">
	insert into user_device_token (device_token,device_id,updated_at,created_at) values (#{device_token},#{device_id},now(),now())
	</insert>
	<select id="getAllUserDeviecToken" resultType="com.lucifer.model.UserDeviceToken">
	select * from user_device_token;
	</select>
	
</mapper>