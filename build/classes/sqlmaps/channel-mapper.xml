<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lucifer.model">

  <insert id="insertChannel">
  	insert into channel (id,name,visible) values (#{id},#{name},0)
  </insert>
  
  <update id="updateChannel">
 	update channel set name=#{name} where id =#{id}
  </update>
  
  <select id="getChannel" resultType="com.lucifer.model.Channel">
  	select * from channel where id = #{id}
  </select>
  
  <select id="channelList" resultType="com.lucifer.model.Channel">
  	<![CDATA[
  	select * from channel where visible<2
  	]]>
	<if test="name != null and name != '' ">
	and name like '${name}%'
	</if> 
	order by id desc
	<if test="offset != null and perPageCount != null">
	limit #{offset},#{perPageCount}
	</if> 
   
  </select>
  
  <select id="channelListCount" resultType="java.lang.Integer">
  	<![CDATA[
  	select count(*) from channel where visible<2
  	]]>
	<if test="name != null and name != '' ">
	and name like '${name}%'
	</if> 
  </select>
  
  <delete id="deleteChannel">
  update channel set visible = 2 where id = #{id}
  </delete>
  
  <select id="bookList" resultType="com.lucifer.model.Book">
  <![CDATA[
  	select c.id,c.name,c.cover from book_channel b , book c where b.b_id =c.id and c.visible<2 and b.c_id=#{c_id} limit 6
  ]]>
  </select>
  
</mapper>